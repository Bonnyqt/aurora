{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reserve | Aurora</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&family=Montserrat&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(
        rgba(115, 84, 13, 0.85), 
        rgba(0, 0, 0, 0.8)
      ), url('https://scontent.fmnl14-1.fna.fbcdn.net/v/t39.30808-6/489822689_654455527343534_821614516300584445_n.jpg?_nc_cat=100&ccb=1-7&_nc_sid=127cfc&_nc_eui2=AeGGF_e67l1S_y4Ux-R9955eiBg8m9x8LGyIGDyb3HwsbPIqmO0J9vs6lFJk5ONYqoi15YbXTLGMgmw-fPLgYRbW&_nc_ohc=gLy7jf4ST1UQ7kNvwH78d7q&_nc_oc=AdnG6krtOsaiy1uvkZmKZc0iUJd-RvQktgzWpgfxFxsVqQXu8DTWaPLDKzWZv2NQjwg&_nc_zt=23&_nc_ht=scontent.fmnl14-1.fna&_nc_gid=FxUDlukCVM9U7tSbtO0w2g&oh=00_AfQVMUKVmoK0yjQ56My3IL9zTAxIYCFV4T_DdcrLrma54A&oe=688658B8');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
    }

   .hero {
      padding: 120px 0 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      text-align: center;
      position: relative;
      z-index: 1;
    }

    .hero h1 {
      font-family: 'Playfair Display', serif;
      font-size: 3.5em;
      margin: 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
      color: #af7f10;
    }

    .hero p {
      font-size: 1.2em;
      margin-top: 10px;
      color: #ffffff;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
    }

    .reservation-container {
      max-width: 1200px;
      margin: -80px auto 40px;
      padding: 40px;
      background: rgba(248, 249, 250, 0.95);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      position: relative;
      z-index: 10;
    }

    .reservation-container h2 {
      font-family: 'Playfair Display', serif;
      font-size: 2.5em;
      text-align: center;
      margin-bottom: 30px;
      color: #af7f10;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      margin-top: 0;
    }

    /* Table Selection Area */
    .restaurant-layout {
      margin-bottom: 40px;
      text-align: center;
    }

    .restaurant-layout h3 {
      font-family: 'Playfair Display', serif;
      font-size: 1.8em;
      margin-bottom: 20px;
      color: #af7f10;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }

    .floor-plan {
      position: relative;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border: 3px solid #af7f10;
      border-radius: 15px;
      height: 600px; /* Increased height for better spacing */
      margin: 20px auto;
      max-width: 1000px; /* Increased width */
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      /* Add subtle wood texture pattern */
      background-image: 
        repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(171, 127, 16, 0.1) 2px, rgba(171, 127, 16, 0.1) 4px);
    }

    /* Restaurant Features with Fine Dining Aesthetic */
    .restaurant-feature {
      position: absolute;
      background: rgba(248, 249, 250, 0.95);
      color: #2c2c2c;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 600;
      border: 2px solid #af7f10;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      font-family: 'Playfair Display', serif;
    }

    .entrance {
      background: linear-gradient(135deg, #d4edda, #c3e6cb);
      color: #155724;
      border-color: #28a745;
    }

    .exit {
      background: linear-gradient(135deg, #f8d7da, #f5c6cb);
      color: #721c24;
      border-color: #dc3545;
    }

    .bar {
      background: linear-gradient(135deg, #d2691e, #8b4513);
      color: white;
      border-color: #8b4513;
    }

    .kitchen {
      background: linear-gradient(135deg, #fff3cd, #ffeaa7);
      color: #856404;
      border-color: #ffc107;
    }

    .bathroom {
      background: linear-gradient(135deg, #d1ecf1, #bee5eb);
      color: #0c5460;
      border-color: #17a2b8;
    }

    .cashier {
      background: linear-gradient(135deg, #cce5ff, #99d6ff);
      color: #004085;
      border-color: #007bff;
    }

    .window-view {
      background: linear-gradient(135deg, #e2f3ff, #cce7ff);
      color: #003d82;
      border-color: #0066cc;
    }

    .vip-area {
      background: linear-gradient(135deg, #e2d5f1, #d1c4e9);
      color: #4a148c;
      border-color: #6f42c1;
    }

    /* Elegant Table Design - Like Fine Dining */
    .table-item {
      position: absolute;
      background: linear-gradient(135deg, #ffffff, #f8f9fa);
      color: #2c2c2c;
      border-radius: 8px; /* Rectangular tables like fine dining */
      width: 70px;
      height: 50px; /* Rectangular shape */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 3px solid #af7f10;
      box-shadow: 
        0 4px 12px rgba(171, 127, 16, 0.2),
        inset 0 2px 4px rgba(255, 255, 255, 0.8);
      text-shadow: none;
      z-index: 10;
      font-family: 'Playfair Display', serif;
      /* Add table cloth effect */
      background-image: radial-gradient(circle at center, rgba(171, 127, 16, 0.05) 0%, transparent 70%);
    }

    /* Before pseudo-element for table base/legs */
    .table-item::before {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 50%;
      transform: translateX(-50%);
      width: 30px;
      height: 6px;
      background: linear-gradient(135deg, #8b4513, #654321);
      border-radius: 3px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    /* Table chairs representation */
    .table-item::after {
      content: '';
      position: absolute;
      top: -3px;
      left: -3px;
      right: -3px;
      bottom: -3px;
      border: 1px dashed rgba(171, 127, 16, 0.3);
      border-radius: 8px;
      pointer-events: none;
    }

    /* Location-specific table styles */
    .table-item.indoor {
      background: linear-gradient(135deg, #ffffff, #f8f9fa);
      border-color: #af7f10;
    }

    .table-item.outdoor {
      background: linear-gradient(135deg, #f0fff4, #e8f5e8);
      border-color: #28a745;
      /* Add outdoor umbrella effect */
      box-shadow: 
        0 4px 12px rgba(40, 167, 69, 0.2),
        inset 0 2px 4px rgba(255, 255, 255, 0.8),
        0 -10px 0 -8px rgba(40, 167, 69, 0.1);
    }

    .table-item.private {
      background: linear-gradient(135deg, #fff8e1, #fffacd);
      border-color: #ff8f00;
      /* Add curtain effect */
      box-shadow: 
        0 4px 12px rgba(255, 143, 0, 0.2),
        inset 0 2px 4px rgba(255, 255, 255, 0.8),
        inset 0 0 0 2px rgba(255, 143, 0, 0.1);
    }

    .table-item.vip {
      background: linear-gradient(135deg, #f3e5f5, #e1bee7);
      border-color: #6f42c1;
      /* Add crown effect */
      position: relative;
    }

    .table-item.vip::before {
      background: linear-gradient(135deg, #6f42c1, #4a148c);
    }

    /* Hover effects */
    .table-item:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 
        0 8px 20px rgba(171, 127, 16, 0.3),
        inset 0 2px 4px rgba(255, 255, 255, 0.9);
      border-color: #d6c3a4;
    }

    .table-item.selected {
      background: linear-gradient(135deg, #d4edda, #c3e6cb);
      border-color: #28a745;
      transform: translateY(-5px) scale(1.1);
      box-shadow: 
        0 10px 25px rgba(40, 167, 69, 0.4),
        inset 0 2px 4px rgba(255, 255, 255, 0.9);
      color: #155724;
    }

    .table-item.disabled {
      opacity: 0.4;
      pointer-events: none;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border-color: #6c757d;
      color: #6c757d;
    }

    .table-number {
      font-weight: 700;
      font-size: 16px;
      letter-spacing: 0.5px;
    }

    .table-capacity {
      font-size: 10px;
      opacity: 0.8;
      font-style: italic;
    }

    /* Floor layout elements with fine dining aesthetics */
    .wall {
      position: absolute;
      background: linear-gradient(135deg, #8b4513, #654321);
      border: 1px solid #5d2f0c;
      box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.2);
    }

    /* Add elegant floor patterns */
    .floor-pattern {
      position: absolute;
      background: repeating-linear-gradient(
        45deg,
        rgba(171, 127, 16, 0.03),
        rgba(171, 127, 16, 0.03) 20px,
        transparent 20px,
        transparent 40px
      );
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    /* Enhanced Legend */
    .floor-legend {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      padding: 20px;
      background: linear-gradient(135deg, rgba(248, 249, 250, 0.9), rgba(255, 255, 255, 0.8));
      border-radius: 15px;
      border: 2px solid rgba(171, 127, 16, 0.2);
      backdrop-filter: blur(10px);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #2c2c2c;
      font-family: 'Playfair Display', serif;
      padding: 5px 10px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.7);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .legend-color {
      width: 24px;
      height: 16px;
      border-radius: 4px;
      border: 2px solid #2c2c2c;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .legend-feature {
      width: 18px;
      height: 18px;
      border-radius: 4px;
      border: 1px solid #2c2c2c;
    }

    /* Add dining ambiance elements */
    .chandelier {
      position: absolute;
      top: 30px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 30px;
      background: radial-gradient(circle, #ffd700, #ffed4e);
      border-radius: 50% 50% 20% 20%;
      box-shadow: 
        0 4px 8px rgba(255, 215, 0, 0.3),
        inset 0 2px 4px rgba(255, 255, 255, 0.5);
      z-index: 5;
    }

    .chandelier::before {
      content: '‚ú®';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 16px;
    }

    /* Piano area */
    .piano {
      position: absolute;
      bottom: 100px;
      right: 250px;
      width: 60px;
      height: 40px;
      background: linear-gradient(135deg, #1a1a1a, #2c2c2c);
      border-radius: 8px;
      border: 2px solid #333;
      z-index: 5;
    }

    .piano::before {
      content: 'üéπ';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
    }

    /* Form Styling */
    .reservation-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      margin-top: 30px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group.full-width {
      grid-column: span 2;
    }

    .form-group label {
      font-weight: 600;
      margin-bottom: 8px;
      color: #2c2c2c;
      font-size: 14px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 12px 16px;
      border: 2px solid rgba(171, 127, 16, 0.3);
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Montserrat', sans-serif;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      background: rgba(255, 255, 255, 0.9);
      color: #2c2c2c;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #af7f10;
      box-shadow: 0 0 0 3px rgba(175, 127, 16, 0.2);
      background: white;
    }

    .checkbox-group {
      flex-direction: row;
      align-items: center;
      gap: 10px;
    }

    .checkbox-group input[type="checkbox"] {
      width: auto;
      margin: 0;
      accent-color: #af7f10;
    }

    .checkbox-group label {
      color: #2c2c2c;
    }

    .reserve-btn {
      grid-column: span 2;
      padding: 16px 32px;
      font-size: 16px;
      font-weight: 600;
      background: linear-gradient(135deg, #af7f10 0%, #d6c3a4 100%);
      color: white;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Montserrat', sans-serif;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 20px;
      box-shadow: 0 4px 15px rgba(171, 127, 16, 0.3);
    }

    .reserve-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(171, 127, 16, 0.4);
    }

    .reserve-btn:disabled {
      background: #666;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* Enhanced Alert Messages */
    .alert {
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .alert-dismissible {
      padding-right: 50px;
    }

    .alert-close {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.3s ease;
      color: inherit;
    }

    .alert-close:hover {
      opacity: 1;
    }

    .alert-info {
      background: rgba(231, 243, 255, 0.9);
      color: #0066cc;
      border: 1px solid rgba(179, 217, 255, 0.5);
    }

    .alert-warning {
      background: rgba(255, 243, 205, 0.9);
      color: #856404;
      border: 1px solid rgba(255, 234, 167, 0.5);
    }

    .alert-success {
      background: rgba(212, 237, 218, 0.9);
      color: #155724;
      border: 1px solid rgba(195, 230, 203, 0.5);
    }

    .alert-error {
      background: rgba(248, 215, 218, 0.9);
      color: #721c24;
      border: 1px solid rgba(245, 198, 203, 0.5);
    }

    /* Add animation for alert removal */
    .alert-fade-out {
      animation: fadeOut 0.5s ease forwards;
    }

    @keyframes fadeOut {
      from { 
        opacity: 1; 
        transform: translateY(0);
        max-height: 60px;
      }
      to { 
        opacity: 0; 
        transform: translateY(-20px);
        max-height: 0;
        margin: 0;
        padding: 0;
      }
    }

    /* Mobile Responsiveness */
    @media (max-width: 768px) {
      body {
        background-attachment: scroll;
      }

      .hero h1 {
        font-size: 2.5em;
      }

      .reservation-container {
        margin: 20px;
        padding: 30px 20px;
      }

      .reservation-form {
        grid-template-columns: 1fr;
      }

      .reserve-btn {
        grid-column: span 1;
      }

      .floor-plan {
        height: 450px;
        max-width: 100%;
      }
      
      .table-item {
        width: 55px;
        height: 40px;
      }
      
      .restaurant-feature {
        font-size: 9px;
        padding: 6px 10px;
      }
      
      .table-number {
        font-size: 14px;
      }

      .table-capacity {
        font-size: 9px;
      }

      .chandelier,
      .piano {
        display: none; /* Hide decorative elements on mobile */
      }

      .alert-dismissible {
        padding-right: 40px;
      }
    }

    /* Loading State */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .loading .reserve-btn::after {
      content: "";
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #ffffff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s ease-in-out infinite;
      margin-left: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Timeout message specific styling */
    .timeout-alert {
      background: rgba(255, 243, 205, 0.95) !important;
      color: #856404 !important;
      border: 2px solid #af7f10 !important;
    }
  </style>
</head>
<body>

  {% include 'myapp/pacificstar/baseHeader.html' %}

  <div class="hero">
    <div>
      <h1>Reserve Your Table</h1>
      <p>Experience culinary excellence with us</p>
    </div>
  </div>

  <section class="reservation-container">
    <h2>Book Your Experience</h2>

    <!-- Enhanced Alert Messages with Close Buttons -->
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible" id="alert-{{ forloop.counter }}">
          <span>{{ message }}</span>
          <button type="button" class="alert-close" onclick="dismissAlert('alert-{{ forloop.counter }}')" title="Click to dismiss">&times;</button>
        </div>
      {% endfor %}
    {% endif %}

    <!-- Enhanced Table Selection with Restaurant Layout -->
    {% if tables %}
    <div class="restaurant-layout">
      <h3><i class="fas fa-utensils" style="color: #af7f10; margin-right: 10px;"></i>Select Your Preferred Table</h3>
      <div class="alert alert-info">
        <i class="fas fa-info-circle"></i> Click on a table to select it. Tables are positioned as they appear in our restaurant layout.
      </div>
      
      <div class="floor-plan">
        <!-- Add elegant floor pattern -->
        <div class="floor-pattern"></div>
        
        <!-- Restaurant Walls with fine dining style -->
        <div class="wall" style="top: 0; left: 0; width: 100%; height: 8px;"></div>
        <div class="wall" style="top: 0; left: 0; width: 8px; height: 100%;"></div>
        <div class="wall" style="bottom: 0; left: 0; width: 100%; height: 8px;"></div>
        <div class="wall" style="top: 0; right: 0; width: 8px; height: 100%;"></div>
        
        <!-- Elegant Chandelier -->
        <div class="chandelier"></div>
        
        <!-- Piano for ambiance -->
        <div class="piano"></div>
        
        <!-- Restaurant Features with Fine Dining Layout -->
        <!-- Main Entrance with Host Station -->
        <div class="restaurant-feature entrance" style="top: 15px; left: 50%; transform: translateX(-50%);">
          <i class="fas fa-door-open"></i> HOST STATION
        </div>
        
        <!-- Service Exit -->
        <div class="restaurant-feature exit" style="bottom: 15px; right: 30px;">
          <i class="fas fa-sign-out-alt"></i> SERVICE EXIT
        </div>
        
        <!-- Wine Bar & Cocktail Lounge -->
        <div class="restaurant-feature bar" style="top: 80px; right: 30px; width: 140px; height: 60px; display: flex; align-items: center; justify-content: center; flex-direction: column;">
          <i class="fas fa-wine-glass"></i>
          <span>WINE BAR</span>
        </div>
        
        <!-- Chef's Kitchen -->
        <div class="restaurant-feature kitchen" style="top: 30px; left: 30px; width: 120px; height: 50px; display: flex; align-items: center; justify-content: center; flex-direction: column;">
          <i class="fas fa-chef-hat"></i>
          <span>CHEF'S KITCHEN</span>
        </div>
        
        <!-- Sommelier Station -->
        <div class="restaurant-feature cashier" style="top: 90px; left: 30px; width: 100px; height: 40px; display: flex; align-items: center; justify-content: center; flex-direction: column;">
          <i class="fas fa-concierge-bell"></i>
          <span>SOMMELIER</span>
        </div>
        
        <!-- Private Lounge -->
        <div class="restaurant-feature bathroom" style="bottom: 30px; left: 30px; width: 90px; height: 40px; display: flex; align-items: center; justify-content: center; flex-direction: column;">
          <i class="fas fa-crown"></i>
          <span>PRIVATE LOUNGE</span>
        </div>
        
        <!-- VIP Dining Room -->
        <div class="restaurant-feature vip-area" style="top: 160px; right: 30px; width: 120px; height: 100px; display: flex; align-items: center; justify-content: center; flex-direction: column;">
          <i class="fas fa-star"></i>
          <span>VIP DINING</span>
          <span style="font-size: 9px;">PRIVATE ROOM</span>
        </div>
        
        <!-- Scenic Views -->
        <div class="restaurant-feature window-view" style="top: 30px; left: 35%; width: 250px; height: 30px; display: flex; align-items: center; justify-content: center;">
          <i class="fas fa-mountain"></i> PANORAMIC CITY VIEW
        </div>
        
        <div class="restaurant-feature window-view" style="bottom: 80px; left: 35%; width: 220px; height: 30px; display: flex; align-items: center; justify-content: center;">
          <i class="fas fa-tree"></i> GARDEN TERRACE VIEW
        </div>
        
        <!-- Tables with fine dining positioning -->
        {% for table in tables %}
        <div class="table-item {{ table.location }}" 
             data-table-id="{{ table.id }}"
             data-capacity="{{ table.capacity }}"
             data-location="{{ table.location }}"
             style="left: {{ table.x_position }}px; top: {{ table.y_position }}px;"
             title="Table {{ table.table_number }} - {{ table.capacity }} guests ({{ table.get_location_display }})&#10;{{ table.get_position_description }}">
          <div class="table-number">{{ table.table_number }}</div>
          <div class="table-capacity">{{ table.capacity }} guests</div>
        </div>
        {% endfor %}
      </div>
      
      <!-- Enhanced Legend for Fine Dining -->
      <div class="floor-legend">
        <div class="legend-item">
          <span style="font-weight: bold; color: #af7f10; font-size: 16px;">üçΩÔ∏è Dining Areas:</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: linear-gradient(135deg, #ffffff, #f8f9fa); border-color: #af7f10;"></div>
          <span>Main Dining</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: linear-gradient(135deg, #f0fff4, #e8f5e8); border-color: #28a745;"></div>
          <span>Garden Terrace</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: linear-gradient(135deg, #fff8e1, #fffacd); border-color: #ff8f00;"></div>
          <span>Private Dining</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: linear-gradient(135deg, #f3e5f5, #e1bee7); border-color: #6f42c1;"></div>
          <span>VIP Experience</span>
        </div>
        
        <div class="legend-item" style="margin-left: 30px;">
          <span style="font-weight: bold; color: #af7f10; font-size: 16px;">üèõÔ∏è Amenities:</span>
        </div>
        <div class="legend-item">
          <div class="legend-feature entrance"></div>
          <span>Host Station</span>
        </div>
        <div class="legend-item">
          <div class="legend-feature bar"></div>
          <span>Wine Bar</span>
        </div>
        <div class="legend-item">
          <div class="legend-feature window-view"></div>
          <span>Premium Views</span>
        </div>
        <div class="legend-item">
          <div class="legend-feature vip-area"></div>
          <span>VIP Services</span>
        </div>
      </div>
      
      <div id="table-selection-info" class="alert alert-warning" style="display: none;">
        <i class="fas fa-exclamation-triangle"></i> Please select a table before proceeding with your reservation.
      </div>
    </div>
    {% else %}
    <div class="alert alert-warning">
      <i class="fas fa-exclamation-triangle"></i> No tables are currently available. Please try again later.
    </div>
    {% endif %}

    <!-- Reservation Form -->
    <form id="reservationForm" method="POST" class="reservation-form">
      {% csrf_token %}
      <input type="hidden" id="selected_table" name="table_id" {% if tables %}required{% endif %}>
      
      <div class="form-group">
        <label for="guest_name"><i class="fas fa-user"></i> Full Name *</label>
        <input type="text" id="guest_name" name="guest_name" required>
      </div>
      
      <div class="form-group">
        <label for="email"><i class="fas fa-envelope"></i> Email Address *</label>
        <input type="email" id="email" name="email" required>
      </div>
      
      <div class="form-group">
        <label for="mobile_number"><i class="fas fa-phone"></i> Mobile Number *</label>
        <input type="tel" id="mobile_number" name="mobile_number" required placeholder="+63 XXX XXX XXXX">
      </div>
      
      <div class="form-group">
        <label for="party_size"><i class="fas fa-users"></i> Party Size *</label>
        <select id="party_size" name="party_size" required>
          <option value="">Select party size</option>
          {% for i in guest_range %}
            <option value="{{ i }}">{{ i }} person{{ i|pluralize }}</option>
          {% endfor %}
        </select>
      </div>
      
      <div class="form-group">
        <label for="reservation_date"><i class="fas fa-calendar"></i> Date *</label>
        <input type="date" id="reservation_date" name="reservation_date" required>
      </div>
      
      <div class="form-group">
        <label for="reservation_time"><i class="fas fa-clock"></i> Time *</label>
        <select id="reservation_time" name="reservation_time" required>
          <option value="">Select time</option>
          <option value="11:00">11:00 AM</option>
          <option value="11:30">11:30 AM</option>
          <option value="12:00">12:00 PM</option>
          <option value="12:30">12:30 PM</option>
          <option value="13:00">1:00 PM</option>
          <option value="13:30">1:30 PM</option>
          <option value="18:00">6:00 PM</option>
          <option value="18:30">6:30 PM</option>
          <option value="19:00">7:00 PM</option>
          <option value="19:30">7:30 PM</option>
          <option value="20:00">8:00 PM</option>
          <option value="20:30">8:30 PM</option>
        </select>
      </div>
      
      <div class="form-group full-width">
        <label for="special_requests"><i class="fas fa-comment"></i> Special Requests (Optional)</label>
        <textarea id="special_requests" name="special_requests" rows="3" placeholder="Dietary restrictions, special occasions, seating preferences, etc."></textarea>
      </div>
      
      <div class="form-group checkbox-group full-width">
        <input type="checkbox" id="promo_updates" name="promo_updates">
        <label for="promo_updates">
          <i class="fas fa-bell"></i> I want to receive updates on future promos and events
        </label>
      </div>
      
      <button type="submit" class="reserve-btn" id="submitBtn">
        <i class="fas fa-check"></i> Confirm Reservation
      </button>
    </form>
  </section>

  {% include 'myapp/pacificstar/baseFooter.html' %}

  <script>
    // Alert dismissal function
    function dismissAlert(alertId) {
      const alert = document.getElementById(alertId);
      if (alert) {
        alert.classList.add('alert-fade-out');
        setTimeout(() => {
          if (alert.parentNode) {
            alert.remove();
          }
        }, 500);
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      const tableItems = document.querySelectorAll('.table-item');
      const selectedTableInput = document.getElementById('selected_table');
      const tableSelectionInfo = document.getElementById('table-selection-info');
      const form = document.getElementById('reservationForm');
      const submitBtn = document.getElementById('submitBtn');
      
      // Auto-dismiss success messages after 8 seconds
      const successAlerts = document.querySelectorAll('.alert-success');
      successAlerts.forEach((alert, index) => {
        setTimeout(() => {
          if (alert.parentNode) {
            dismissAlert(alert.id);
          }
        }, 8000);
      });

      // Auto-dismiss error messages after 12 seconds
      const errorAlerts = document.querySelectorAll('.alert-error');
      errorAlerts.forEach((alert, index) => {
        setTimeout(() => {
          if (alert.parentNode) {
            dismissAlert(alert.id);
          }
        }, 12000);
      });

      // Clear any lingering reservation success messages when returning to page
      if (document.referrer.includes('success') || sessionStorage.getItem('reservationComplete')) {
        setTimeout(() => {
          document.querySelectorAll('.alert-success').forEach(alert => {
            if (alert.textContent.includes('Reference:') || alert.textContent.includes('confirmed')) {
              dismissAlert(alert.id);
            }
          });
          sessionStorage.removeItem('reservationComplete');
        }, 100);
      }
      
      // Set minimum date to today
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('reservation_date').setAttribute('min', today);
      
      // Table selection functionality
      tableItems.forEach(item => {
        item.addEventListener('click', function() {
          // Remove selection from all tables
          tableItems.forEach(table => table.classList.remove('selected'));
          
          // Add selection to clicked table
          this.classList.add('selected');
          
          // Update hidden input
          selectedTableInput.value = this.dataset.tableId;
          
          // Hide warning message
          tableSelectionInfo.style.display = 'none';
          
          // Show selected table info
          const tableNumber = this.querySelector('.table-number').textContent;
          const capacity = this.dataset.capacity;
          const location = this.dataset.location;
          
          console.log(`Selected Table ${tableNumber} (${capacity} guests, ${location})`);
        });
      });
      
      // Form validation with timeout protection
      form.addEventListener('submit', function(e) {
        if (tableItems.length > 0 && !selectedTableInput.value) {
          e.preventDefault();
          tableSelectionInfo.style.display = 'block';
          tableSelectionInfo.scrollIntoView({ behavior: 'smooth' });
          return;
        }
        
        // Add loading state
        form.classList.add('loading');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
        
        // Mark reservation as complete for cleanup
        sessionStorage.setItem('reservationComplete', 'true');
        
        // Timeout protection - if form doesn't submit in 30 seconds, re-enable
        const timeoutId = setTimeout(() => {
            console.warn('Form submission timeout - re-enabling form');
            form.classList.remove('loading');
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-check"></i> Confirm Reservation';
            
            // Show timeout message
            const timeoutAlert = document.createElement('div');
            timeoutAlert.className = 'alert alert-warning alert-dismissible timeout-alert';
            timeoutAlert.id = 'timeout-alert';
            timeoutAlert.innerHTML = `
                <span><i class="fas fa-exclamation-triangle"></i> Request timeout. Please try again.</span>
                <button type="button" class="alert-close" onclick="dismissAlert('timeout-alert')">&times;</button>
            `;
            
            const container = document.querySelector('.reservation-container');
            container.insertBefore(timeoutAlert, container.firstChild);
            
            // Auto-dismiss timeout alert
            setTimeout(() => {
                if (document.getElementById('timeout-alert')) {
                    dismissAlert('timeout-alert');
                }
            }, 5000);
            
        }, 30000); // 30 second timeout
        
        // Clear timeout if form actually submits
        form.addEventListener('submit', () => {
            clearTimeout(timeoutId);
        }, { once: true });
      });
      
      // Party size and table capacity validation
      const partySizeSelect = document.getElementById('party_size');
      partySizeSelect.addEventListener('change', function() {
        const selectedSize = parseInt(this.value);
        
        tableItems.forEach(item => {
          const tableCapacity = parseInt(item.dataset.capacity);
          if (selectedSize > tableCapacity) {
            item.classList.add('disabled');
          } else {
            item.classList.remove('disabled');
          }
        });
        
        // Clear selection if current table can't accommodate party size
        const currentSelection = document.querySelector('.table-item.selected');
        if (currentSelection) {
          const currentCapacity = parseInt(currentSelection.dataset.capacity);
          if (selectedSize > currentCapacity) {
            currentSelection.classList.remove('selected');
            selectedTableInput.value = '';
          }
        }
      });
    });
  </script>
</body>
</html>